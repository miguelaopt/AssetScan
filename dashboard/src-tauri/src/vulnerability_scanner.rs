// src-tauri/src/vulnerability_scanner.rs
use crate::models::{SoftwareEntry, Vulnerability};

pub async fn scan_machine_vulnerabilities(
    machine_id: &str,
    software_list: &[SoftwareEntry],
) -> Result<Vec<Vulnerability>, String> {
    let mut vulnerabilities = Vec::new();

    println!("[Scanner] A analisar vulnerabilidades para a máquina: {}", machine_id);
    
    // Para cada software:
    // 1. Query NVD API: https://services.nvd.nist.gov/rest/json/cves/2.0
    // 2. Match version com CVEs
    
    // Dummy return para estrutura inicial
    if software_list.iter().any(|s| s.name.to_lowercase().contains("chrome") && s.version < "114.0".to_string()) {
        vulnerabilities.push(Vulnerability {
            id: 0,
            machine_id: machine_id.to_string(),
            software_name: "Google Chrome".to_string(),
            software_version: "Desatualizado".to_string(),
            cve_id: "CVE-2023-XXXX".to_string(),
            severity: "HIGH".to_string(),
            description: Some("Vulnerabilidade crítica em versão antiga do Chrome.".to_string()),
            published_date: None,
            last_checked: None,
            status: "open".to_string(),
        });
    }

    Ok(vulnerabilities)
}